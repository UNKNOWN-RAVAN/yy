<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title>Video - Video Player</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&amp;display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script><style type="text/css">* {user-select: auto !important; -webkit-user-select: auto !important;}</style><input type="hidden" id="inject_idm_text_selection">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: #000;
    font-family: 'Roboto', sans-serif;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

.player-container {
    width: 100%;
    max-width: 1200px;
    background: #000;
    position: relative;
    aspect-ratio: 16/9;
    overflow: hidden;
}

video, .youtube-iframe {
    width: 100%;
    height: 100%;
    display: block;
    border: none;
}

.youtube-iframe {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
}

/* Logo in Left Top Corner */
.logo-container {
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 100;
    display: flex;
    align-items: center;
    gap: 10px;
    pointer-events: none;
}

.logo-image {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    object-fit: cover;
}

/* Watermark (Right Bottom) */
.watermark {
    position: absolute;
    bottom: 20px;
    right: 20px;
    color: rgba(255, 255, 255, 0.8);
    font-size: 20px;
    font-weight: bold;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
    z-index: 100;
    pointer-events: none;
    opacity: 0.9;
}

/* Ads Overlay */
.ad-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    z-index: 200;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.ad-overlay.active {
    display: flex;
}

.ad-video {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.ad-info {
    position: absolute;
    top: 20px;
    left: 20px;
    color: white;
    background: rgba(0, 0, 0, 0.7);
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 14px;
    z-index: 201;
}

.ad-skip-button {
    position: absolute;
    bottom: 30px;
    right: 30px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    border: 2px solid white;
    padding: 10px 25px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    z-index: 201;
    transition: all 0.3s;
    opacity: 0;
    pointer-events: none;
}

.ad-skip-button.show {
    opacity: 1;
    pointer-events: auto;
}

.ad-skip-button:hover {
    background: rgba(255, 255, 255, 0.9);
    color: #000;
}

.ad-timer {
    position: absolute;
    top: 20px;
    right: 20px;
    color: white;
    background: rgba(0, 0, 0, 0.7);
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 14px;
    z-index: 201;
}

.ad-link {
    position: absolute;
    bottom: 30px;
    left: 30px;
    background: rgba(0, 174, 255, 0.9);
    color: white;
    border: none;
    padding: 10px 25px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    z-index: 201;
    text-decoration: none;
    transition: all 0.3s;
}

.ad-link:hover {
    background: rgba(0, 210, 255, 1);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 174, 255, 0.4);
}

/* Controls Container */
.controls-container {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
    padding: 10px;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 150;
}

.player-container:hover .controls-container,
.player-container.paused .controls-container,
.player-container.show-controls .controls-container {
    opacity: 1;
}

/* Rotate Button */
.rotate-button {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(0, 0, 0, 0.5);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 100;
    opacity: 1;
    transition: all 0.3s;
}

.rotate-button:hover {
    background: rgba(255, 255, 255, 0.2);
}

.rotate-button svg {
    width: 22px;
    height: 22px;
    fill: #fff;
}

/* Progress Bar */
.progress-bar {
    width: 100%;
    height: 4px;
    background: rgba(255,255,255,0.2);
    margin-bottom: 10px;
    cursor: pointer;
    position: relative;
}

.progress {
    height: 100%;
    background: #ff0000;
    width: 0%;
    position: relative;
}

.progress-thumb {
    position: absolute;
    right: -6px;
    top: 50%;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    background: #ff0000;
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.2s;
}

.progress-bar:hover .progress-thumb {
    opacity: 1;
}

.buffered {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: rgba(255,255,255,0.4);
    width: 0%;
}

/* Share and Download Buttons Row */
.share-download-row {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 10px;
    padding-top: 5px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.share-button, .download-button {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    padding: 8px 20px;
    border-radius: 20px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.share-button:hover, .download-button:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.share-button svg, .download-button svg {
    width: 18px;
    height: 18px;
    fill: currentColor;
}

/* Controls Row */
.controls-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 5px;
}

.left-controls, .right-controls {
    display: flex;
    align-items: center;
    gap: 15px;
}

.control-btn {
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.control-btn svg {
    width: 24px;
    height: 24px;
    fill: currentColor;
}

.control-btn:hover {
    color: #ccc;
}

/* Play/Pause Button - Single Button with Changing Icon */
.play-icon { display: block; }
.pause-icon { display: none; }
.player-container:not(.paused) .play-icon { display: none; }
.player-container:not(.paused) .pause-icon { display: block; }

/* Mute/Unmute Button - Single Button with Changing Icon */
.mute-icon { display: block; }
.unmute-icon { display: none; }
.player-container.muted .mute-icon { display: none; }
.player-container.muted .unmute-icon { display: block; }

/* Fullscreen Button - Single Button with Changing Icon */
.fullscreen-icon { display: block; }
.exit-fullscreen-icon { display: none; }
.player-container.fullscreen .fullscreen-icon { display: none; }
.player-container.fullscreen .exit-fullscreen-icon { display: block; }

/* Time Display - YouTube Style */
.time-display {
    color: #fff;
    font-size: 14px;
    font-family: 'Roboto', monospace;
    display: flex;
    align-items: center;
    gap: 5px;
}

.time-display .current-time {
    color: #fff;
}

.time-display .duration {
    color: rgba(255, 255, 255, 0.7);
}

.time-display .separator {
    color: rgba(255, 255, 255, 0.5);
}

.volume-container {
    display: flex;
    align-items: center;
    gap: 8px;
}

.volume-slider {
    width: 0;
    opacity: 0;
    transition: all 0.3s;
}

.volume-container:hover .volume-slider {
    width: 60px;
    opacity: 1;
}

.volume-slider {
    -webkit-appearance: none;
    height: 4px;
    background: rgba(255,255,255,0.2);
    border-radius: 2px;
    outline: none;
}

.volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 12px;
    height: 12px;
    background: #fff;
    border-radius: 50%;
    cursor: pointer;
}

/* Speed Button */
.speed-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: #fff;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 14px;
    border-radius: 4px;
    min-width: 50px;
    text-align: center;
}

.speed-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.speed-options {
    position: absolute;
    bottom: 100%;
    right: 0;
    background: rgba(28,28,28,0.95);
    border-radius: 4px;
    padding: 8px 0;
    min-width: 80px;
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s;
    z-index: 100;
}

.speed-menu:hover .speed-options {
    opacity: 1;
    visibility: visible;
}

.speed-option {
    padding: 8px 16px;
    color: #fff;
    cursor: pointer;
    font-size: 14px;
    text-align: center;
}

.speed-option:hover {
    background: rgba(255,255,255,0.1);
}

.speed-option.active {
    color: #3ea6ff;
}

/* Quality Button */
.quality-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: #fff;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 14px;
    border-radius: 4px;
    min-width: 60px;
    text-align: center;
}

.quality-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.quality-options {
    position: absolute;
    bottom: 100%;
    right: 0;
    background: rgba(28,28,28,0.95);
    border-radius: 4px;
    padding: 8px 0;
    min-width: 100px;
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s;
    z-index: 100;
}

.quality-menu:hover .quality-options {
    opacity: 1;
    visibility: visible;
}

.quality-option {
    padding: 8px 16px;
    color: #fff;
    cursor: pointer;
    font-size: 14px;
    text-align: center;
    white-space: nowrap;
}

.quality-option:hover {
    background: rgba(255,255,255,0.1);
}

.quality-option.active {
    color: #3ea6ff;
}

/* Seek Notification */
.seek-notification {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 10px 20px;
    border-radius: 4px;
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 10px;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
    z-index: 140;
}

.seek-notification.show {
    opacity: 1;
}

/* Play/Pause Overlay */
.play-pause-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    background: rgba(0,0,0,0.6);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
    z-index: 140;
}

.play-pause-overlay.show {
    opacity: 1;
}

.play-pause-overlay svg {
    width: 40px;
    height: 40px;
    fill: #fff;
}

/* Loading Spinner */
.loading-spinner {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 50px;
    height: 50px;
    border: 3px solid rgba(255,255,255,0.1);
    border-top: 3px solid #ff0000;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    display: none;
    z-index: 130;
}

@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Double Tap Areas */
.double-tap-area {
    position: absolute;
    top: 0;
    height: 100%;
    width: 33%;
    z-index: 125;
    pointer-events: auto;
}

.double-tap-left {
    left: 0;
}

.double-tap-center {
    left: 33%;
    width: 34%;
}

.double-tap-right {
    right: 0;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .player-container {
        max-width: 100%;
        height: auto;
    }
    
    .logo-container {
        top: 10px;
        left: 10px;
    }
    
    .logo-image {
        width: 40px;
        height: 40px;
    }
    
    .watermark {
        bottom: 10px;
        right: 10px;
        font-size: 16px;
    }
    
    .volume-slider {
        width: 50px !important;
        opacity: 1 !important;
    }
    
    .time-display {
        min-width: 100px;
        font-size: 12px;
    }
    
    .control-btn svg {
        width: 20px;
        height: 20px;
    }
    
    .rotate-button {
        top: 10px;
        right: 10px;
        width: 35px;
        height: 35px;
    }
    
    .speed-btn, .quality-btn {
        padding: 4px 8px;
        font-size: 12px;
        min-width: 45px;
    }
    
    .left-controls, .right-controls {
        gap: 10px;
    }
    
    .ad-skip-button {
        bottom: 20px;
        right: 20px;
        padding: 8px 20px;
        font-size: 14px;
    }
    
    .ad-link {
        bottom: 20px;
        left: 20px;
        padding: 8px 20px;
        font-size: 14px;
    }
    
    .share-download-row {
        gap: 10px;
        margin-bottom: 5px;
    }
    
    .share-button, .download-button {
        padding: 6px 15px;
        font-size: 12px;
    }
}

/* Hide controls on mobile when not interacting */
@media (hover: none) and (pointer: coarse) {
    .controls-container {
        opacity: 1;
        transition: opacity 0.5s;
    }
    
    .player-container:not(.show-controls):not(.paused) .controls-container {
        opacity: 0;
    }
}
</style>
<style></style></head>
<body>
<div class="player-container" id="playerContainer">
    <!-- Main Video -->
    <video id="video"></video>
    <!-- YouTube iframe (hidden initially) -->
    <iframe class="youtube-iframe" id="youtubeIframe" style="display: none;" allowfullscreen allow="autoplay; encrypted-media; picture-in-picture"></iframe>
    
    <!-- Double Tap Areas -->
    <div class="double-tap-area double-tap-left" id="doubleTapLeft"></div>
    <div class="double-tap-area double-tap-center" id="doubleTapCenter"></div>
    <div class="double-tap-area double-tap-right" id="doubleTapRight"></div>
    
    <!-- Logo in Left Top Corner -->
    <div class="logo-container" id="logoContainer">
        <img class="logo-image" id="logoImage" src="" alt="Logo" crossorigin="anonymous">
    </div>
    
    <!-- Watermark (Right Bottom) -->
    <div class="watermark" id="watermark"></div>
    
    <!-- Ads Overlay -->
    <div class="ad-overlay" id="adOverlay">
        <video class="ad-video" id="adVideo" preload="auto"></video>
        <div class="ad-info" id="adInfo">Advertisement</div>
        <div class="ad-timer" id="adTimer">Skip in 20s</div>
        <button class="ad-skip-button" id="adSkipButton">Skip Ad</button>
        <a class="ad-link" id="adLink" target="_blank">Visit Website</a>
    </div>
    
    <!-- Rotate Button -->
    <button class="rotate-button" id="rotateBtn" title="Rotate Screen">
        <svg viewBox="0 0 24 24">
            <path d="M7.47 21.49C4.2 19.93 1.86 16.76 1.5 13H0c.5 6.16 5.66 11 11.95 11 .23 0 .44-.02.66-.03L8.8 20.15l-1.33 1.34zM12.05 0c-.23 0-.44.02-.66.04l3.81 3.81 1.33-1.33C19.8 4.07 22.14 7.24 22.5 11H24c-.5-6.16-5.66-11-11.95-11zM16 14h2V8a2 2 0 0 0-2-2h-6v2h6v6zm-8 0V4H6v2H4v2h2v8a2 2 0 0 0 2 2h8v2h2v-2h2v-2H8z"></path>
        </svg>
    </button>
    
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner"></div>
    
    <!-- Play/Pause Overlay -->
    <div class="play-pause-overlay" id="playPauseOverlay">
        <svg class="play-overlay-icon"><use href="#icon-pause"></use></svg>
    </div>
    
    <!-- Seek Notification -->
    <div class="seek-notification" id="seekNotification">
        <svg id="seekIcon"><use href="#icon-rewind"></use></svg>
        <span id="seekText">10s</span>
    </div>
    
    <!-- Controls Container -->
    <div class="controls-container" id="controlsContainer">
        <!-- Progress Bar -->
        <div class="progress-bar" id="progressBar">
            <div class="buffered" id="buffered"></div>
            <div class="progress" id="progress">
                <div class="progress-thumb"></div>
            </div>
        </div>
        
        <!-- Share & Download Row -->
        <div class="share-download-row" id="shareDownloadRow">
            <button class="share-button" id="shareBtn">
                <svg viewBox="0 0 24 24">
                    <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"></path>
                </svg>
                Share
            </button>
            <button class="download-button" id="downloadBtn">
                <svg viewBox="0 0 24 24">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"></path>
                </svg>
                Download
            </button>
        </div>
        
        <!-- Controls Row -->
        <div class="controls-row">
            <div class="left-controls">
                <!-- Single Play/Pause Button -->
                <button class="control-btn" id="playPauseBtn" title="Play/Pause">
                    <svg class="play-icon"><use href="#icon-play"></use></svg>
                    <svg class="pause-icon"><use href="#icon-pause"></use></svg>
                </button>
                
                <!-- 10s Rewind Button -->
                <button class="control-btn" id="rewindBtn" title="Rewind 10s">
                    <svg><use href="#icon-rewind"></use></svg>
                </button>
                
                <!-- 10s Forward Button -->
                <button class="control-btn" id="forwardBtn" title="Forward 10s">
                    <svg><use href="#icon-forward"></use></svg>
                </button>
                
                <!-- Single Mute/Unmute Button -->
                <div class="volume-container">
                    <button class="control-btn" id="muteBtn" title="Mute/Unmute">
                        <svg class="mute-icon"><use href="#icon-mute"></use></svg>
                        <svg class="unmute-icon"><use href="#icon-unmute"></use></svg>
                    </button>
                    <input class="volume-slider" id="volumeSlider" type="range" min="0" max="1" step="0.01" value="1">
                </div>
                
                <!-- YouTube Style Time Display -->
                <div class="time-display">
                    <span class="current-time" id="currentTime">0:00</span>
                    <span class="separator">/</span>
                    <span class="duration" id="duration">0:00</span>
                </div>
            </div>
            
            <div class="right-controls">
                <!-- Quality Button with Menu -->
                <div class="quality-menu">
                    <button class="quality-btn" id="qualityBtn">Auto</button>
                    <div class="quality-options" id="qualityOptions">
                        <div class="quality-option" data-quality="auto">Auto</div>
                    </div>
                </div>
                
                <!-- Speed Button with Menu -->
                <div class="speed-menu">
                    <button class="speed-btn" id="speedBtn">1x</button>
                    <div class="speed-options" id="speedOptions">
                        <div class="speed-option" data-speed="0.25">0.25x</div>
                        <div class="speed-option" data-speed="0.5">0.5x</div>
                        <div class="speed-option active" data-speed="1">1x</div>
                        <div class="speed-option" data-speed="1.25">1.25x</div>
                        <div class="speed-option" data-speed="1.5">1.5x</div>
                        <div class="speed-option" data-speed="2">2x</div>
                    </div>
                </div>
                
                <!-- Single Fullscreen Button -->
                <button class="control-btn" id="fullscreenBtn" title="Fullscreen">
                    <svg class="fullscreen-icon"><use href="#icon-fullscreen"></use></svg>
                    <svg class="exit-fullscreen-icon"><use href="#icon-exit-fullscreen"></use></svg>
                </button>
            </div>
        </div>
    </div>
</div>

<svg style="display: none;">
    <symbol id="icon-play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></symbol>
    <symbol id="icon-pause" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></symbol>
    <symbol id="icon-rewind" viewBox="0 0 24 24"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"></path></symbol>
    <symbol id="icon-forward" viewBox="0 0 24 24"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"></path></symbol>
    <symbol id="icon-fullscreen" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></symbol>
    <symbol id="icon-exit-fullscreen" viewBox="0 0 24 24"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></symbol>
    <symbol id="icon-mute" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></symbol>
    <symbol id="icon-unmute" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></symbol>
</svg>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get elements
    const playerContainer = document.getElementById('playerContainer');
    const video = document.getElementById('video');
    const youtubeIframe = document.getElementById('youtubeIframe');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const playOverlayIcon = document.getElementById('playOverlayIcon');
    const rewindBtn = document.getElementById('rewindBtn');
    const forwardBtn = document.getElementById('forwardBtn');
    const muteBtn = document.getElementById('muteBtn');
    const volumeSlider = document.getElementById('volumeSlider');
    const currentTimeEl = document.getElementById('currentTime');
    const durationEl = document.getElementById('duration');
    const progressBar = document.getElementById('progressBar');
    const progress = document.getElementById('progress');
    const buffered = document.getElementById('buffered');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const speedBtn = document.getElementById('speedBtn');
    const speedOptions = document.querySelectorAll('.speed-option');
    const qualityBtn = document.getElementById('qualityBtn');
    const qualityOptions = document.getElementById('qualityOptions');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const playPauseOverlay = document.getElementById('playPauseOverlay');
    const seekNotification = document.getElementById('seekNotification');
    const seekIcon = document.getElementById('seekIcon');
    const seekText = document.getElementById('seekText');
    const rotateBtn = document.getElementById('rotateBtn');
    const doubleTapLeft = document.getElementById('doubleTapLeft');
    const doubleTapCenter = document.getElementById('doubleTapCenter');
    const doubleTapRight = document.getElementById('doubleTapRight');
    
    // New elements
    const logoImage = document.getElementById('logoImage');
    const watermark = document.getElementById('watermark');
    const shareBtn = document.getElementById('shareBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    
    // Ads elements
    const adOverlay = document.getElementById('adOverlay');
    const adVideo = document.getElementById('adVideo');
    const adTimer = document.getElementById('adTimer');
    const adSkipButton = document.getElementById('adSkipButton');
    const adLink = document.getElementById('adLink');
    const adInfo = document.getElementById('adInfo');
    
    // State variables
    let hls = null;
    let currentQuality = 'auto';
    let controlsTimeout = null;
    let isYouTubeVideo = false;
    let ytPlayer = null;
    let ytStateCheckInterval = null;
    
    // Ads state
    let adsData = [];
    let currentAd = null;
    let isShowingAd = false;
    let adHls = null;
    let adDuration = 0;
    let adRemainingTime = 0;
    let adTimerInterval = null;
    let shownAdIds = new Set();
    let adSkipTimeout = null;
    let canSkipAd = false;
    
    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const videoUrl = urlParams.get('video');
    let videoTitle = urlParams.get('title') || 'Video';
    const appName = urlParams.get('app') || 'All';
    
    // Decode URL parameters
    videoTitle = decodeURIComponent(videoTitle);
    videoTitle = videoTitle.replace(/[+]/g, ' ');
    
    // Set page title
    document.title = videoTitle + ' - Video Player';
    
    // Function to cache image
    function cacheImage(url) {
        return new Promise((resolve, reject) => {
            const img = new Image();
            // Set cache headers via fetch first
            fetch(url, {
                method: 'GET',
                mode: 'cors',
                cache: 'force-cache'
            })
            .then(response => response.blob())
            .then(blob => {
                const objectUrl = URL.createObjectURL(blob);
                img.src = objectUrl;
                img.onload = () => {
                    resolve(objectUrl);
                };
                img.onerror = reject;
            })
            .catch(() => {
                // Fallback to direct load if fetch fails
                img.src = url;
                img.onload = () => resolve(url);
                img.onerror = reject;
            });
        });
    }
    
    // Fetch ads data
    async function fetchAdsData() {
        try {
            console.log('Fetching ads data...');
            const response = await fetch('https://yy-pi-three.vercel.app/ads.json', {
                cache: 'force-cache' // Cache the ads JSON too
            });
            const data = await response.json();
            
            // Handle different response formats
            if (Array.isArray(data)) {
                adsData = data;
            } else if (data.ads) {
                adsData = data.ads;
            } else if (data.data) {
                adsData = data.data;
            } else {
                // Use single ad from your example
                adsData = [{
                    "available": false,
                    "time": "0%",
                    "url": "https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8",
                    "link": "https://t.me/@ravan09",
                    "duration": 20,
                    "size": "13mb",
                    "app": "All",
                    "download+autocopyvideotitle": true,
                    "Watermark": "UNKNOWN",
                    "WatermarkLogo": "https://i.ibb.co/992hqrvw/file-0000000083c072069007687f4f4c6769.png",
                    "youtube": true,
                    "downloader": "https://qooly.com/d/?query=simpleURL",
                    "date": "24-05-2026"
                }];
            }
            
            console.log('Ads loaded:', adsData.length, 'ads found');
            
            // Set watermark and logo from first ad if available with caching
            if (adsData.length > 0) {
                const firstAd = adsData[0];
                
                // Set watermark logo with caching
                if (firstAd.WatermarkLogo) {
                    cacheImage(firstAd.WatermarkLogo).then(cachedUrl => {
                        logoImage.src = cachedUrl;
                        // Add cache headers via meta
                        const meta = document.createElement('meta');
                        meta.httpEquiv = 'Cache-Control';
                        meta.content = 'public, max-age=31536000, immutable';
                        document.head.appendChild(meta);
                    }).catch(() => {
                        logoImage.src = firstAd.WatermarkLogo;
                    });
                }
                
                // Set watermark text
                if (firstAd.Watermark) {
                    watermark.textContent = firstAd.Watermark;
                }
            }
            
        } catch (error) {
            console.error('Error loading ads:', error);
            // Use default settings with caching
            cacheImage("https://i.ibb.co/992hqrvw/file-0000000083c072069007687f4f4c6769.png")
                .then(cachedUrl => {
                    logoImage.src = cachedUrl;
                })
                .catch(() => {
                    logoImage.src = "https://i.ibb.co/992hqrvw/file-0000000083c072069007687f4f4c6769.png";
                });
            watermark.textContent = "UNKNOWN";
            
            // Use sample ad
            adsData = [{
                "available": false,
                "time": "0%",
                "url": "https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8",
                "link": "https://t.me/@ravan09",
                "duration": 20,
                "app": "All",
                "Watermark": "UNKNOWN",
                "WatermarkLogo": "https://i.ibb.co/992hqrvw/file-0000000083c072069007687f4f4c6769.png",
                "youtube": true
            }];
        }
    }
    
    // Check if ad should be shown
    function shouldShowAd(currentTime, duration) {
        if (!adsData.length || isShowingAd || !duration) return false;
        
        const percentage = (currentTime / duration) * 100;
        
        for (const ad of adsData) {
            const adId = ad.url + (ad.time || ad.timePercentage || '0%');
            
            if (ad.available && 
                !shownAdIds.has(adId) &&
                (ad.app === 'All' || ad.app === appName)) {
                
                const timePercent = parseFloat(ad.time || ad.timePercentage || '0');
                if (timePercent <= percentage) {
                    shownAdIds.add(adId);
                    return ad;
                }
            }
        }
        return false;
    }
    
    // Show ad
    function showAd(ad) {
        console.log('Showing ad:', ad);
        
        if (!ad || !ad.url || isShowingAd) return;
        
        currentAd = ad;
        isShowingAd = true;
        adDuration = parseInt(ad.duration) || 20;
        adRemainingTime = adDuration;
        canSkipAd = false;
        
        // Pause main video
        if (isYouTubeVideo && ytPlayer) {
            ytPlayer.pauseVideo();
        } else {
            video.pause();
        }
        
        // Show ad overlay
        adOverlay.classList.add('active');
        
        // Set ad link
        adLink.href = ad.link || '#';
        adLink.textContent = 'Visit Website';
        
        // Update ad info
        adInfo.textContent = 'Advertisement';
        
        // Load ad video
        loadAdVideo(ad.url);
        
        // Start ad timer
        startAdTimer();
        
        // Hide skip button initially
        adSkipButton.classList.remove('show');
        
        // Enable skip button after ad duration
        clearTimeout(adSkipTimeout);
        adSkipTimeout = setTimeout(() => {
            canSkipAd = true;
            adSkipButton.classList.add('show');
        }, adDuration * 1000);
    }
    
    // Load ad video
    function loadAdVideo(url) {
        console.log('Loading ad video:', url);
        
        if (adHls) {
            adHls.destroy();
            adHls = null;
        }
        
        adVideo.pause();
        adVideo.src = '';
        
        if (Hls.isSupported()) {
            adHls = new Hls({
                enableWorker: false,
                lowLatencyMode: true,
                maxBufferLength: 10
            });
            
            adHls.loadSource(url);
            adHls.attachMedia(adVideo);
            
            adHls.on(Hls.Events.MANIFEST_PARSED, () => {
                console.log('Ad manifest parsed, playing...');
                adVideo.play().catch(e => {
                    console.log('Ad autoplay blocked:', e);
                });
            });
            
            adHls.on(Hls.Events.ERROR, (event, data) => {
                console.error('Ad HLS error:', data);
                if (data.fatal) {
                    skipAd();
                }
            });
        } else if (adVideo.canPlayType('application/vnd.apple.mpegurl')) {
            adVideo.src = url;
            adVideo.play().catch(e => {
                console.log('Ad autoplay blocked:', e);
            });
        } else {
            skipAd();
        }
    }
    
    // Start ad timer
    function startAdTimer() {
        updateAdTimer();
        clearInterval(adTimerInterval);
        adTimerInterval = setInterval(() => {
            adRemainingTime--;
            updateAdTimer();
            
            // Auto skip only when ad finishes, not based on timer
            if (adVideo.ended) {
                skipAd();
            }
        }, 1000);
    }
    
    // Update ad timer display
    function updateAdTimer() {
        if (canSkipAd) {
            adTimer.textContent = 'Skip Ad';
        } else {
            adTimer.textContent = `Skip in ${adRemainingTime}s`;
        }
    }
    
    // Skip ad
    function skipAd() {
        console.log('Skipping ad');
        
        isShowingAd = false;
        canSkipAd = false;
        
        // Hide ad overlay
        adOverlay.classList.remove('active');
        adSkipButton.classList.remove('show');
        
        // Stop ad video
        adVideo.pause();
        adVideo.src = '';
        
        // Destroy HLS instance
        if (adHls) {
            adHls.destroy();
            adHls = null;
        }
        
        // Clear timers
        clearInterval(adTimerInterval);
        clearTimeout(adSkipTimeout);
        
        // Resume main video
        if (isYouTubeVideo && ytPlayer) {
            ytPlayer.playVideo();
        } else {
            video.play();
        }
        
        // Show controls
        showControlsTemporarily();
    }
    
    // Extract YouTube video ID
    function extractYouTubeId(url) {
        const patterns = [
            /(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&?/]+)/,
            /youtube\.com\/embed\/([^/?]+)/,
            /youtube\.com\/v\/([^/?]+)/
        ];
        
        for (const pattern of patterns) {
            const match = url.match(pattern);
            if (match) return match[1];
        }
        return null;
    }
    
    // Load YouTube video
    function loadYouTubeVideo(videoId) {
        console.log('Loading YouTube video:', videoId);
        
        isYouTubeVideo = true;
        video.style.display = 'none';
        youtubeIframe.style.display = 'block';
        
        // Create YouTube iframe with embed URL
        youtubeIframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1&controls=0&modestbranding=1&rel=0&showinfo=0`;
        
        // Load YouTube IFrame API if not already loaded
        if (!window.YT) {
            const tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }
        
        // Wait for API to be ready
        window.onYouTubeIframeAPIReady = function() {
            createYouTubePlayer(videoId);
        };
        
        // If API already loaded
        if (window.YT && YT.Player) {
            createYouTubePlayer(videoId);
        }
    }
    
    function createYouTubePlayer(videoId) {
        ytPlayer = new YT.Player('youtubeIframe', {
            videoId: videoId,
            events: {
                'onReady': onYouTubePlayerReady,
                'onStateChange': onYouTubeStateChange
            }
        });
    }
    
    function onYouTubePlayerReady(event) {
        console.log('YouTube player ready');
        loadingSpinner.style.display = 'none';
        
        // Start checking time for ads
        if (ytStateCheckInterval) clearInterval(ytStateCheckInterval);
        ytStateCheckInterval = setInterval(() => {
            if (ytPlayer && ytPlayer.getCurrentTime && ytPlayer.getDuration) {
                const currentTime = ytPlayer.getCurrentTime();
                const duration = ytPlayer.getDuration();
                
                // Update time display for YouTube
                if (currentTimeEl && durationEl) {
                    currentTimeEl.textContent = formatTime(currentTime);
                    durationEl.textContent = formatTime(duration);
                }
                
                // Update progress bar for YouTube
                if (progress && duration) {
                    const percent = (currentTime / duration) * 100;
                    progress.style.width = percent + '%';
                }
                
                // Check for ads
                if (!isShowingAd && duration > 0) {
                    const ad = shouldShowAd(currentTime, duration);
                    if (ad) {
                        showAd(ad);
                    }
                }
            }
        }, 500);
    }
    
    function onYouTubeStateChange(event) {
        // Update play/pause state
        if (event.data === YT.PlayerState.PLAYING) {
            playerContainer.classList.remove('paused');
            loadingSpinner.style.display = 'none';
        } else if (event.data === YT.PlayerState.PAUSED) {
            playerContainer.classList.add('paused');
        } else if (event.data === YT.PlayerState.BUFFERING) {
            loadingSpinner.style.display = 'block';
        } else if (event.data === YT.PlayerState.ENDED) {
            playerContainer.classList.add('paused');
        }
    }
    
    // Initialize video
    function initializeVideo() {
        if (!videoUrl) return;
        
        // Check if it's a YouTube URL
        const youtubeId = extractYouTubeId(videoUrl);
        
        if (youtubeId) {
            // Check if YouTube support is enabled in ads
            const youtubeAd = adsData.find(ad => ad.youtube === true);
            
            if (youtubeAd) {
                loadYouTubeVideo(youtubeId);
            } else {
                // Fallback to redirect
                window.location.href = `https://www.youtube.com/watch?v=${youtubeId}`;
            }
        } else if (Hls.isSupported() && videoUrl.includes('.m3u8')) {
            // HLS stream
            hls = new Hls({
                enableWorker: true,
                lowLatencyMode: true,
                backBufferLength: 90
            });
            
            hls.loadSource(videoUrl);
            hls.attachMedia(video);
            
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                loadingSpinner.style.display = 'none';
                
                // Add quality options
                qualityOptions.innerHTML = '<div class="quality-option active" data-quality="auto">Auto</div>';
                if (hls.levels && hls.levels.length > 0) {
                    hls.levels.forEach((level, index) => {
                        const option = document.createElement('div');
                        option.className = 'quality-option';
                        option.dataset.quality = index;
                        option.textContent = level.height + 'p';
                        qualityOptions.appendChild(option);
                    });
                    
                    currentQuality = hls.levels.length - 1;
                    hls.currentLevel = currentQuality;
                    qualityBtn.textContent = hls.levels[currentQuality].height + 'p';
                }
                
                video.play().catch(() => {
                    playerContainer.classList.add('paused');
                });
            });
            
            hls.on(Hls.Events.LEVEL_SWITCHED, function(event, data) {
                if (data.level === -1) {
                    currentQuality = 'auto';
                    qualityBtn.textContent = 'Auto';
                } else {
                    currentQuality = data.level;
                    qualityBtn.textContent = hls.levels[data.level].height + 'p';
                }
                
                document.querySelectorAll('.quality-option').forEach(opt => {
                    opt.classList.remove('active');
                    if (opt.dataset.quality === String(data.level) || 
                        (data.level === -1 && opt.dataset.quality === 'auto')) {
                        opt.classList.add('active');
                    }
                });
            });
            
            hls.on(Hls.Events.ERROR, function(event, data) {
                console.error('HLS error:', data);
                if (data.fatal) {
                    switch(data.type) {
                        case Hls.ErrorTypes.NETWORK_ERROR:
                            hls.startLoad();
                            break;
                        case Hls.ErrorTypes.MEDIA_ERROR:
                            hls.recoverMediaError();
                            break;
                        default:
                            hls.destroy();
                            break;
                    }
                }
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            // Safari HLS
            video.src = videoUrl;
            loadingSpinner.style.display = 'none';
            video.play().catch(() => {
                playerContainer.classList.add('paused');
            });
        } else {
            // Direct video file
            video.src = videoUrl;
            loadingSpinner.style.display = 'none';
            video.play().catch(() => {
                playerContainer.classList.add('paused');
            });
        }
    }
    
    // Start initialization
    fetchAdsData().then(() => {
        initializeVideo();
    });
    
    // Quality selection
    qualityOptions.addEventListener('click', function(e) {
        const option = e.target.closest('.quality-option');
        if (!option) return;
        
        const quality = option.dataset.quality;
        if (hls) {
            if (quality === 'auto') {
                hls.currentLevel = -1;
            } else {
                hls.currentLevel = parseInt(quality);
            }
            currentQuality = quality;
        }
        
        document.querySelectorAll('.quality-option').forEach(opt => {
            opt.classList.remove('active');
        });
        option.classList.add('active');
        
        qualityBtn.textContent = option.textContent;
        showControlsTemporarily();
    });
    
    // Speed selection
    speedOptions.forEach(option => {
        option.addEventListener('click', function() {
            const speed = parseFloat(this.dataset.speed);
            if (isYouTubeVideo && ytPlayer) {
                ytPlayer.setPlaybackRate(speed);
            } else {
                video.playbackRate = speed;
            }
            speedBtn.textContent = speed + 'x';
            
            speedOptions.forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');
            
            showControlsTemporarily();
        });
    });
    
    // Play/Pause
    function togglePlayPause() {
        if (isShowingAd) return;
        
        if (isYouTubeVideo && ytPlayer) {
            const state = ytPlayer.getPlayerState();
            if (state === YT.PlayerState.PLAYING) {
                ytPlayer.pauseVideo();
                playerContainer.classList.add('paused');
            } else {
                ytPlayer.playVideo();
                playerContainer.classList.remove('paused');
            }
        } else {
            if (video.paused) {
                video.play();
                playerContainer.classList.remove('paused');
                playOverlayIcon.innerHTML = '<use href="#icon-pause"></use>';
            } else {
                video.pause();
                playerContainer.classList.add('paused');
                playOverlayIcon.innerHTML = '<use href="#icon-play"></use>';
            }
        }
        showPlayPauseOverlay();
        showControlsTemporarily();
    }
    
    playPauseBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        togglePlayPause();
    });
    
    // Double Tap Areas
    function setupDoubleTapArea(area, action) {
        let lastTap = 0;
        let tapCount = 0;
        let timeout = null;
        
        area.addEventListener('touchstart', function(e) {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;
            
            if (tapLength < 300 && tapLength > 0) {
                e.preventDefault();
                e.stopPropagation();
                action();
                tapCount = 0;
                clearTimeout(timeout);
            } else {
                tapCount = 1;
                timeout = setTimeout(() => {
                    tapCount = 0;
                }, 300);
            }
            
            lastTap = currentTime;
        });
        
        area.addEventListener('dblclick', function(e) {
            e.preventDefault();
            e.stopPropagation();
            action();
        });
    }
    
    setupDoubleTapArea(doubleTapLeft, () => seek(-10));
    setupDoubleTapArea(doubleTapRight, () => seek(10));
    setupDoubleTapArea(doubleTapCenter, () => togglePlayPause());
    
    // Video single click
    if (video) {
        video.addEventListener('click', function(e) {
            if (isShowingAd) return;
            showControlsTemporarily();
        });
    }
    
    // Seek function
    function seek(seconds) {
        if (isShowingAd) return;
        
        if (isYouTubeVideo && ytPlayer) {
            const newTime = ytPlayer.getCurrentTime() + seconds;
            ytPlayer.seekTo(Math.max(0, Math.min(newTime, ytPlayer.getDuration())));
        } else {
            const newTime = video.currentTime + seconds;
            video.currentTime = Math.max(0, Math.min(newTime, video.duration));
        }
        
        seekText.textContent = Math.abs(seconds) + 's';
        seekIcon.innerHTML = seconds > 0 ? 
            '<use href="#icon-forward"></use>' : 
            '<use href="#icon-rewind"></use>';
        seekNotification.classList.add('show');
        setTimeout(() => {
            seekNotification.classList.remove('show');
        }, 500);
        
        showControlsTemporarily();
    }
    
    rewindBtn.addEventListener('click', () => seek(-10));
    forwardBtn.addEventListener('click', () => seek(10));
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT' || e.target.tagName === 'BUTTON' || isShowingAd) return;
        
        switch(e.key.toLowerCase()) {
            case ' ':
            case 'k':
                e.preventDefault();
                togglePlayPause();
                break;
            case 'arrowleft':
                e.preventDefault();
                seek(-5);
                break;
            case 'arrowright':
                e.preventDefault();
                seek(5);
                break;
            case 'arrowup':
                e.preventDefault();
                adjustVolume(0.1);
                break;
            case 'arrowdown':
                e.preventDefault();
                adjustVolume(-0.1);
                break;
            case 'f':
                e.preventDefault();
                toggleFullscreen();
                break;
            case 'm':
                e.preventDefault();
                toggleMute();
                break;
        }
    });
    
    // Volume
    function adjustVolume(change) {
        if (isYouTubeVideo && ytPlayer) {
            // YouTube volume is 0-100
            const newVolume = Math.max(0, Math.min(100, (ytPlayer.getVolume() || 100) + (change * 100)));
            ytPlayer.setVolume(newVolume);
            volumeSlider.value = newVolume / 100;
        } else {
            const newVolume = Math.max(0, Math.min(1, video.volume + change));
            video.volume = newVolume;
            volumeSlider.value = newVolume;
        }
        updateMuteButton();
    }
    
    volumeSlider.addEventListener('input', function() {
        if (isYouTubeVideo && ytPlayer) {
            ytPlayer.setVolume(this.value * 100);
        } else {
            video.volume = this.value;
        }
        updateMuteButton();
    });
    
    muteBtn.addEventListener('click', toggleMute);
    
    function toggleMute() {
        if (isShowingAd) {
            adVideo.muted = !adVideo.muted;
        } else if (isYouTubeVideo && ytPlayer) {
            if (ytPlayer.isMuted()) {
                ytPlayer.unMute();
            } else {
                ytPlayer.mute();
            }
        } else {
            video.muted = !video.muted;
        }
        updateMuteButton();
        showControlsTemporarily();
    }
    
    function updateMuteButton() {
        let isMuted = false;
        if (isShowingAd) {
            isMuted = adVideo.muted;
        } else if (isYouTubeVideo && ytPlayer) {
            isMuted = ytPlayer.isMuted();
        } else {
            isMuted = video.muted;
        }
        playerContainer.classList.toggle('muted', isMuted);
    }
    
    video.addEventListener('volumechange', updateMuteButton);
    adVideo.addEventListener('volumechange', updateMuteButton);
    
    // Time display
    function updateTimeDisplay() {
        if (!isYouTubeVideo) {
            const current = formatTime(video.currentTime);
            const duration = formatTime(video.duration);
            
            currentTimeEl.textContent = current;
            durationEl.textContent = duration;
        }
    }
    
    function formatTime(seconds) {
        if (isNaN(seconds)) return '0:00';
        const hours = Math.floor(seconds / 3600);
        const mins = Math.floor((seconds % 3600) / 60);
        const secs = Math.floor(seconds % 60);
        
        if (hours > 0) {
            return `${hours}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        } else {
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
    }
    
    // Progress bar
    function updateProgress() {
        if (!isYouTubeVideo && video.duration) {
            const percent = (video.currentTime / video.duration) * 100;
            progress.style.width = percent + '%';
        }
    }
    
    function updateBuffered() {
        if (!isYouTubeVideo && video.buffered.length > 0 && video.duration > 0) {
            const bufferedEnd = video.buffered.end(video.buffered.length - 1);
            const percent = (bufferedEnd / video.duration) * 100;
            buffered.style.width = percent + '%';
        }
    }
    
    progressBar.addEventListener('click', function(e) {
        if (isShowingAd) return;
        
        const rect = this.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        
        if (isYouTubeVideo && ytPlayer) {
            const duration = ytPlayer.getDuration();
            ytPlayer.seekTo(percent * duration);
        } else {
            video.currentTime = percent * video.duration;
        }
        showControlsTemporarily();
    });
    
    // Rotate button
    rotateBtn.addEventListener('click', function() {
        if (screen.orientation && screen.orientation.lock) {
            if (!document.fullscreenElement) {
                if (playerContainer.requestFullscreen) {
                    playerContainer.requestFullscreen().then(() => {
                        screen.orientation.lock('landscape').catch(() => {});
                    });
                }
            } else {
                screen.orientation.lock('landscape').catch(() => {});
            }
        } else {
            toggleFullscreen();
        }
        showControlsTemporarily();
    });
    
    // Fullscreen
    fullscreenBtn.addEventListener('click', toggleFullscreen);
    
    function toggleFullscreen() {
        if (!document.fullscreenElement) {
            if (playerContainer.requestFullscreen) {
                playerContainer.requestFullscreen();
            } else if (playerContainer.webkitRequestFullscreen) {
                playerContainer.webkitRequestFullscreen();
            } else if (playerContainer.msRequestFullscreen) {
                playerContainer.msRequestFullscreen();
            }
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }
        showControlsTemporarily();
    }
    
    document.addEventListener('fullscreenchange', updateFullscreenButton);
    document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
    document.addEventListener('mozfullscreenchange', updateFullscreenButton);
    
    function updateFullscreenButton() {
        const isFullscreen = !!document.fullscreenElement || 
                            !!document.webkitFullscreenElement || 
                            !!document.mozFullScreenElement;
        playerContainer.classList.toggle('fullscreen', isFullscreen);
    }
    
    // Share button
    shareBtn.addEventListener('click', function() {
        const currentUrl = window.location.href;
        
        if (navigator.share) {
            navigator.share({
                title: videoTitle,
                text: 'Check out this video: ' + videoTitle,
                url: currentUrl
            });
        } else {
            navigator.clipboard.writeText(currentUrl).then(() => {
                alert('Link copied to clipboard!');
            });
        }
        
        showControlsTemporarily();
    });
    
    // Download button
    downloadBtn.addEventListener('click', function() {
        if (!videoUrl) return;
        
        // If there's a downloader URL in ads, use it
        if (adsData.length > 0 && adsData[0].downloader) {
            const downloaderUrl = adsData[0].downloader.replace('simpleURL', encodeURIComponent(videoUrl));
            window.open(downloaderUrl, '_blank');
        } else {
            // Fallback to direct download
            const a = document.createElement('a');
            a.href = videoUrl;
            a.download = videoTitle + '.mp4';
            a.click();
        }
        
        showControlsTemporarily();
    });
    
    // Ad skip button
    adSkipButton.addEventListener('click', function() {
        if (canSkipAd) {
            skipAd();
        }
    });
    
    // Ad video ended
    adVideo.addEventListener('ended', function() {
        console.log('Ad video ended');
        skipAd();
    });
    
    // Show play/pause overlay
    function showPlayPauseOverlay() {
        playPauseOverlay.classList.add('show');
        setTimeout(() => {
            playPauseOverlay.classList.remove('show');
        }, 300);
    }
    
    // Show controls temporarily
    function showControlsTemporarily() {
        if (isShowingAd) return;
        
        playerContainer.classList.add('show-controls');
        clearTimeout(controlsTimeout);
        
        if ((isYouTubeVideo && ytPlayer && ytPlayer.getPlayerState && ytPlayer.getPlayerState() === YT.PlayerState.PLAYING) ||
            (!isYouTubeVideo && !video.paused)) {
            controlsTimeout = setTimeout(() => {
                playerContainer.classList.remove('show-controls');
            }, 2000);
        }
    }
    
    // Event listeners
    if (video) {
        video.addEventListener('timeupdate', function() {
            updateTimeDisplay();
            updateProgress();
            
            // Check for ads
            if (!isShowingAd && video.duration > 0) {
                const ad = shouldShowAd(video.currentTime, video.duration);
                if (ad) {
                    showAd(ad);
                }
            }
        });
        
        video.addEventListener('progress', updateBuffered);
        video.addEventListener('loadedmetadata', updateTimeDisplay);
        
        video.addEventListener('waiting', function() {
            loadingSpinner.style.display = 'block';
        });
        
        video.addEventListener('playing', function() {
            loadingSpinner.style.display = 'none';
        });
    }
    
    // Hide controls on inactivity
    playerContainer.addEventListener('mousemove', function() {
        if (!isShowingAd) {
            showControlsTemporarily();
        }
    });
    
    playerContainer.addEventListener('touchstart', function() {
        if (!isShowingAd) {
            showControlsTemporarily();
        }
    });
    
    // Initial setup
    updateMuteButton();
    updateFullscreenButton();
    
    // Auto-hide controls
    setTimeout(() => {
        if (!video.paused && !isYouTubeVideo) {
            playerContainer.classList.remove('show-controls');
        }
    }, 3000);
});
</script>

</body></html>