<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video - Universal Player (YouTube + HLS)</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <!-- HLS.js for m3u8 streams -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            font-family: 'Roboto', sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .player-container {
            width: 100%;
            max-width: 1200px;
            background: #000;
            position: relative;
            aspect-ratio: 16/9;
            overflow: hidden;
        }

        /* Main video / YouTube container */
        #videoElement {
            width: 100%;
            height: 100%;
            display: block;
            cursor: pointer;
            background: #000;
        }
        /* YouTube player iframe */
        #youtubePlayer {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
        }

        /* Logo in Left Top Corner */
        .logo-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 10px;
            pointer-events: none;
        }
        .logo-image {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            object-fit: cover;
        }

        /* Watermark (Right Bottom) */
        .watermark {
            position: absolute;
            bottom: 20px;
            right: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 20px;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
            z-index: 10;
            pointer-events: none;
            opacity: 0.9;
        }

        /* Ads Overlay */
        .ad-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 200;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .ad-overlay.active {
            display: flex;
        }
        .ad-video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .ad-info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 201;
        }
        .ad-skip-button {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: 2px solid white;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            z-index: 201;
            transition: all 0.3s;
            opacity: 0;
            pointer-events: none;
        }
        .ad-skip-button.show {
            opacity: 1;
            pointer-events: auto;
        }
        .ad-skip-button:hover {
            background: rgba(255, 255, 255, 0.9);
            color: #000;
        }
        .ad-timer {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 201;
        }
        .ad-link {
            position: absolute;
            bottom: 30px;
            left: 30px;
            background: rgba(0, 174, 255, 0.9);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            z-index: 201;
            text-decoration: none;
            transition: all 0.3s;
        }
        .ad-link:hover {
            background: rgba(0, 210, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 174, 255, 0.4);
        }

        /* Rotate Button */
        .rotate-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            opacity: 1;
            transition: all 0.3s;
        }
        .rotate-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .rotate-button svg {
            width: 22px;
            height: 22px;
            fill: #fff;
        }

        /* Controls Container */
        .controls-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 10px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 50;
        }
        .player-container:hover .controls-container,
        .player-container.paused .controls-container,
        .player-container.show-controls .controls-container {
            opacity: 1;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.2);
            margin-bottom: 10px;
            cursor: pointer;
            position: relative;
        }
        .progress {
            height: 100%;
            background: #ff0000;
            width: 0%;
            position: relative;
        }
        .progress-thumb {
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #ff0000;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .progress-bar:hover .progress-thumb {
            opacity: 1;
        }
        .buffered {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: rgba(255,255,255,0.4);
            width: 0%;
        }

        /* Share and Download Row - BELOW PROGRESS BAR */
        .share-download-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
            padding-top: 5px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .share-button, .download-button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        .share-button:hover, .download-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        .share-button svg, .download-button svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        /* Controls Row */
        .controls-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 5px;
        }
        .left-controls, .right-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .control-btn {
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .control-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }
        .control-btn:hover {
            color: #ccc;
        }

        /* Play/Pause Button States */
        .play-icon { display: block; }
        .pause-icon { display: none; }
        .player-container:not(.paused) .play-icon { display: none; }
        .player-container:not(.paused) .pause-icon { display: block; }

        /* Mute/Unmute */
        .mute-icon { display: block; }
        .unmute-icon { display: none; }
        .player-container.muted .mute-icon { display: none; }
        .player-container.muted .unmute-icon { display: block; }

        /* Fullscreen Button States */
        .fullscreen-icon { display: block; }
        .exit-fullscreen-icon { display: none; }
        .player-container.fullscreen .fullscreen-icon { display: none; }
        .player-container.fullscreen .exit-fullscreen-icon { display: block; }

        /* Time Display */
        .time-display {
            color: #fff;
            font-size: 14px;
            font-family: 'Roboto', monospace;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .time-display .current-time { color: #fff; }
        .time-display .duration { color: rgba(255, 255, 255, 0.7); }
        .time-display .separator { color: rgba(255, 255, 255, 0.5); }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .volume-slider {
            width: 0;
            opacity: 0;
            transition: all 0.3s;
        }
        .volume-container:hover .volume-slider {
            width: 60px;
            opacity: 1;
        }
        .volume-slider {
            -webkit-appearance: none;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            outline: none;
        }
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Speed Button */
        .speed-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 14px;
            border-radius: 4px;
            min-width: 50px;
            text-align: center;
        }
        .speed-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .speed-options {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: rgba(28,28,28,0.95);
            border-radius: 4px;
            padding: 8px 0;
            min-width: 80px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            z-index: 100;
        }
        .speed-menu:hover .speed-options {
            opacity: 1;
            visibility: visible;
        }
        .speed-option {
            padding: 8px 16px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
            text-align: center;
        }
        .speed-option:hover {
            background: rgba(255,255,255,0.1);
        }
        .speed-option.active {
            color: #3ea6ff;
        }

        /* Quality Button */
        .quality-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 14px;
            border-radius: 4px;
            min-width: 60px;
            text-align: center;
        }
        .quality-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .quality-options {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: rgba(28,28,28,0.95);
            border-radius: 4px;
            padding: 8px 0;
            min-width: 100px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            z-index: 100;
        }
        .quality-menu:hover .quality-options {
            opacity: 1;
            visibility: visible;
        }
        .quality-option {
            padding: 8px 16px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
            text-align: center;
            white-space: nowrap;
        }
        .quality-option:hover {
            background: rgba(255,255,255,0.1);
        }
        .quality-option.active {
            color: #3ea6ff;
        }

        /* Seek Notification */
        .seek-notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 40;
        }
        .seek-notification.show {
            opacity: 1;
        }

        /* Play/Pause Overlay */
        .play-pause-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(0,0,0,0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 40;
        }
        .play-pause-overlay.show {
            opacity: 1;
        }
        .play-pause-overlay svg {
            width: 40px;
            height: 40px;
            fill: #fff;
        }

        /* Loading Spinner */
        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #ff0000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none;
            z-index: 30;
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Double Tap Areas */
        .double-tap-area {
            position: absolute;
            top: 0;
            height: 100%;
            width: 33%;
            z-index: 25;
            pointer-events: auto;
        }
        .double-tap-left { left: 0; }
        .double-tap-center { left: 33%; width: 34%; }
        .double-tap-right { right: 0; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .player-container { max-width: 100%; }
            .logo-container { top: 10px; left: 10px; }
            .logo-image { width: 40px; height: 40px; }
            .watermark { bottom: 10px; right: 10px; font-size: 16px; }
            .volume-slider { width: 50px !important; opacity: 1 !important; }
            .time-display { min-width: 100px; font-size: 12px; }
            .control-btn svg { width: 20px; height: 20px; }
            .rotate-button { top: 10px; right: 10px; width: 35px; height: 35px; }
            .speed-btn, .quality-btn { padding: 4px 8px; font-size: 12px; min-width: 45px; }
            .left-controls, .right-controls { gap: 10px; }
            .ad-skip-button { bottom: 20px; right: 20px; padding: 8px 20px; font-size: 14px; }
            .ad-link { bottom: 20px; left: 20px; padding: 8px 20px; font-size: 14px; }
            .share-download-row { gap: 10px; margin-bottom: 5px; }
            .share-button, .download-button { padding: 6px 15px; font-size: 12px; }
        }
        @media (hover: none) and (pointer: coarse) {
            .controls-container { opacity: 1; transition: opacity 0.5s; }
            .player-container:not(.show-controls):not(.paused) .controls-container { opacity: 0; }
        }
    </style>
</head>
<body>
<div class="player-container" id="playerContainer">
    <!-- Main Video (for HLS/direct) and placeholder for YouTube iframe -->
    <video id="videoElement" playsinline></video>
    <div id="youtubePlayer"></div>

    <!-- Double Tap Areas -->
    <div class="double-tap-area double-tap-left" id="doubleTapLeft"></div>
    <div class="double-tap-area double-tap-center" id="doubleTapCenter"></div>
    <div class="double-tap-area double-tap-right" id="doubleTapRight"></div>

    <!-- Logo in Left Top Corner -->
    <div class="logo-container" id="logoContainer">
        <img class="logo-image" id="logoImage" src="" alt="Logo">
    </div>

    <!-- Watermark (Right Bottom) -->
    <div class="watermark" id="watermark"></div>

    <!-- Ads Overlay -->
    <div class="ad-overlay" id="adOverlay">
        <video class="ad-video" id="adVideo" preload="auto" playsinline></video>
        <div class="ad-info" id="adInfo">Advertisement</div>
        <div class="ad-timer" id="adTimer">Skip in 20s</div>
        <button class="ad-skip-button" id="adSkipButton">Skip Ad</button>
        <a class="ad-link" id="adLink" target="_blank">Visit Website</a>
    </div>

    <!-- Rotate Button -->
    <button class="rotate-button" id="rotateBtn" title="Rotate Screen">
        <svg viewBox="0 0 24 24">
            <path d="M7.47 21.49C4.2 19.93 1.86 16.76 1.5 13H0c.5 6.16 5.66 11 11.95 11 .23 0 .44-.02.66-.03L8.8 20.15l-1.33 1.34zM12.05 0c-.23 0-.44.02-.66.04l3.81 3.81 1.33-1.33C19.8 4.07 22.14 7.24 22.5 11H24c-.5-6.16-5.66-11-11.95-11zM16 14h2V8a2 2 0 0 0-2-2h-6v2h6v6zm-8 0V4H6v2H4v2h2v8a2 2 0 0 0 2 2h8v2h2v-2h2v-2H8z"></path>
        </svg>
    </button>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner"></div>

    <!-- Play/Pause Overlay -->
    <div class="play-pause-overlay" id="playPauseOverlay">
        <svg class="play-overlay-icon"><use href="#icon-pause"></use></svg>
    </div>

    <!-- Seek Notification -->
    <div class="seek-notification" id="seekNotification">
        <svg id="seekIcon"><use href="#icon-rewind"></use></svg>
        <span id="seekText">10s</span>
    </div>

    <!-- Controls Container -->
    <div class="controls-container" id="controlsContainer">
        <!-- Progress Bar -->
        <div class="progress-bar" id="progressBar">
            <div class="buffered" id="buffered"></div>
            <div class="progress" id="progress">
                <div class="progress-thumb"></div>
            </div>
        </div>

        <!-- Share & Download Row -->
        <div class="share-download-row" id="shareDownloadRow">
            <button class="share-button" id="shareBtn">
                <svg viewBox="0 0 24 24">
                    <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"></path>
                </svg>
                Share
            </button>
            <button class="download-button" id="downloadBtn">
                <svg viewBox="0 0 24 24">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"></path>
                </svg>
                Download
            </button>
        </div>

        <!-- Controls Row -->
        <div class="controls-row">
            <div class="left-controls">
                <!-- Single Play/Pause Button -->
                <button class="control-btn" id="playPauseBtn" title="Play/Pause">
                    <svg class="play-icon"><use href="#icon-play"></use></svg>
                    <svg class="pause-icon"><use href="#icon-pause"></use></svg>
                </button>

                <!-- 10s Rewind -->
                <button class="control-btn" id="rewindBtn" title="Rewind 10s">
                    <svg><use href="#icon-rewind"></use></svg>
                </button>

                <!-- 10s Forward -->
                <button class="control-btn" id="forwardBtn" title="Forward 10s">
                    <svg><use href="#icon-forward"></use></svg>
                </button>

                <!-- Volume -->
                <div class="volume-container">
                    <button class="control-btn" id="muteBtn" title="Mute/Unmute">
                        <svg class="mute-icon"><use href="#icon-mute"></use></svg>
                        <svg class="unmute-icon"><use href="#icon-unmute"></use></svg>
                    </button>
                    <input class="volume-slider" id="volumeSlider" type="range" min="0" max="1" step="0.01" value="1">
                </div>

                <!-- Time Display -->
                <div class="time-display">
                    <span class="current-time" id="currentTime">0:00</span>
                    <span class="separator">/</span>
                    <span class="duration" id="duration">0:00</span>
                </div>
            </div>

            <div class="right-controls">
                <!-- Quality Button (HLS) -->
                <div class="quality-menu">
                    <button class="quality-btn" id="qualityBtn">Auto</button>
                    <div class="quality-options" id="qualityOptions">
                        <div class="quality-option active" data-quality="auto">Auto</div>
                    </div>
                </div>

                <!-- Speed Button -->
                <div class="speed-menu">
                    <button class="speed-btn" id="speedBtn">1x</button>
                    <div class="speed-options" id="speedOptions">
                        <div class="speed-option" data-speed="0.25">0.25x</div>
                        <div class="speed-option" data-speed="0.5">0.5x</div>
                        <div class="speed-option active" data-speed="1">1x</div>
                        <div class="speed-option" data-speed="1.25">1.25x</div>
                        <div class="speed-option" data-speed="1.5">1.5x</div>
                        <div class="speed-option" data-speed="2">2x</div>
                    </div>
                </div>

                <!-- Fullscreen Button -->
                <button class="control-btn" id="fullscreenBtn" title="Fullscreen">
                    <svg class="fullscreen-icon"><use href="#icon-fullscreen"></use></svg>
                    <svg class="exit-fullscreen-icon"><use href="#icon-exit-fullscreen"></use></svg>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- SVG Icons -->
<svg style="display: none;">
    <symbol id="icon-play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></symbol>
    <symbol id="icon-pause" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></symbol>
    <symbol id="icon-rewind" viewBox="0 0 24 24"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"></path></symbol>
    <symbol id="icon-forward" viewBox="0 0 24 24"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"></path></symbol>
    <symbol id="icon-fullscreen" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></symbol>
    <symbol id="icon-exit-fullscreen" viewBox="0 0 24 24"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></symbol>
    <symbol id="icon-mute" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></symbol>
    <symbol id="icon-unmute" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></symbol>
</svg>

<script>
(function() {
    // DOM elements
    const playerContainer = document.getElementById('playerContainer');
    const videoElement = document.getElementById('videoElement');        // native video (HLS/direct)
    const youtubeDiv = document.getElementById('youtubePlayer');       // YouTube iframe container
    const playPauseBtn = document.getElementById('playPauseBtn');
    const rewindBtn = document.getElementById('rewindBtn');
    const forwardBtn = document.getElementById('forwardBtn');
    const muteBtn = document.getElementById('muteBtn');
    const volumeSlider = document.getElementById('volumeSlider');
    const currentTimeEl = document.getElementById('currentTime');
    const durationEl = document.getElementById('duration');
    const progressBar = document.getElementById('progressBar');
    const progress = document.getElementById('progress');
    const buffered = document.getElementById('buffered');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const speedBtn = document.getElementById('speedBtn');
    const speedOptions = document.querySelectorAll('.speed-option');
    const qualityBtn = document.getElementById('qualityBtn');
    const qualityOptions = document.getElementById('qualityOptions');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const playPauseOverlay = document.getElementById('playPauseOverlay');
    const seekNotification = document.getElementById('seekNotification');
    const seekIcon = document.getElementById('seekIcon');
    const seekText = document.getElementById('seekText');
    const rotateBtn = document.getElementById('rotateBtn');
    const doubleTapLeft = document.getElementById('doubleTapLeft');
    const doubleTapCenter = document.getElementById('doubleTapCenter');
    const doubleTapRight = document.getElementById('doubleTapRight');
    const logoImage = document.getElementById('logoImage');
    const watermark = document.getElementById('watermark');
    const shareBtn = document.getElementById('shareBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const adOverlay = document.getElementById('adOverlay');
    const adVideo = document.getElementById('adVideo');
    const adTimer = document.getElementById('adTimer');
    const adSkipButton = document.getElementById('adSkipButton');
    const adLink = document.getElementById('adLink');

    // State
    let hls = null;
    let isYouTubeActive = false;
    let ytPlayer = null;               // YouTube player instance
    let ytReady = false;
    let controlsTimeout = null;
    let adsData = [];
    let isShowingAd = false;
    let currentAd = null;
    let adHls = null;
    let adDuration = 0;
    let adRemainingTime = 0;
    let adTimerInterval = null;
    let shownAdIds = new Set();
    let adSkipTimeout = null;
    let canSkipAd = false;
    let isMuted = false;

    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    let videoUrl = urlParams.get('video');
    let videoTitle = urlParams.get('title') || 'Video';
    const appName = urlParams.get('app') || 'All';
    videoTitle = decodeURIComponent(videoTitle).replace(/[+]/g, ' ');
    document.title = videoTitle + ' - Universal Player';

    // Detect YouTube URL
    function isYouTubeUrl(url) {
        if (!url) return false;
        return url.includes('youtube.com/watch') || url.includes('youtu.be/') || url.includes('youtube.com/embed/');
    }

    // Extract YouTube video ID
    function getYouTubeId(url) {
        const regExp = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length === 11) ? match[2] : null;
    }

    // Fetch ads data (as before)
    async function fetchAdsData() {
        try {
            const response = await fetch('https://selection-way-livid.vercel.app/ads.json');
            const data = await response.json();
            if (Array.isArray(data)) adsData = data;
            else if (data.ads) adsData = data.ads;
            else if (data.data) adsData = data.data;
            else {
                adsData = [{
                    "available": false,
                    "time": "0%",
                    "url": "https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8",
                    "link": "https://t.me/@ravan09",
                    "duration": 20,
                    "size": "13mb",
                    "app": "All",
                    "download+autocopyvideotitle": true,
                    "Watermark": "UNKNOWN",
                    "WatermarkLogo": "https://i.ibb.co/992hqrvw/file-0000000083c072069007687f4f4c6769.png",
                    "youtube": true,
                    "downloader": "https://qooly.com/d/?query=simpleURL",
                    "date": "24-05-2026"
                }];
            }
            if (adsData.length > 0) {
                const firstAd = adsData[0];
                if (firstAd.WatermarkLogo) logoImage.src = firstAd.WatermarkLogo;
                if (firstAd.Watermark) watermark.textContent = firstAd.Watermark;
            }
        } catch (error) {
            console.error('Error loading ads:', error);
            logoImage.src = "https://i.ibb.co/992hqrvw/file-0000000083c072069007687f4f4c6769.png";
            watermark.textContent = "UNKNOWN";
            adsData = [{
                "available": false,
                "time": "0%",
                "url": "https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8",
                "link": "https://t.me/@ravan09",
                "duration": 20,
                "app": "All",
                "Watermark": "UNKNOWN",
                "WatermarkLogo": logoImage.src,
                "youtube": true
            }];
        }
    }

    // Initialize player based on URL
    function initPlayer() {
        if (!videoUrl) {
            console.warn('No video URL provided');
            return;
        }

        if (isYouTubeUrl(videoUrl)) {
            // YouTube mode
            isYouTubeActive = true;
            videoElement.style.display = 'none';
            youtubeDiv.style.display = 'block';
            videoElement.pause(); // disable native
            // YouTube player will be created via API
            loadYouTubePlayer(videoUrl);
        } else {
            // HLS or direct video
            isYouTubeActive = false;
            videoElement.style.display = 'block';
            youtubeDiv.style.display = 'none';
            loadNativeVideo(videoUrl);
        }
        fetchAdsData();
    }

    // Native video (HLS/direct) loader
    function loadNativeVideo(url) {
        if (url.includes('.m3u8') && Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(videoElement);
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                loadingSpinner.style.display = 'none';
                // Build quality options
                qualityOptions.innerHTML = '<div class="quality-option" data-quality="auto">Auto</div>';
                if (hls.levels && hls.levels.length > 0) {
                    hls.levels.forEach((level, idx) => {
                        const opt = document.createElement('div');
                        opt.className = 'quality-option';
                        opt.dataset.quality = idx;
                        opt.textContent = level.height + 'p';
                        qualityOptions.appendChild(opt);
                    });
                    // default to highest
                    hls.currentLevel = hls.levels.length - 1;
                    qualityBtn.textContent = hls.levels[hls.levels.length-1].height + 'p';
                }
                videoElement.play().catch(() => playerContainer.classList.add('paused'));
            });
            hls.on(Hls.Events.LEVEL_SWITCHED, (e, data) => {
                if (data.level === -1) qualityBtn.textContent = 'Auto';
                else qualityBtn.textContent = hls.levels[data.level].height + 'p';
            });
        } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
            videoElement.src = url;
            loadingSpinner.style.display = 'none';
            videoElement.play().catch(() => playerContainer.classList.add('paused'));
        } else {
            videoElement.src = url;
            loadingSpinner.style.display = 'none';
            videoElement.play().catch(() => playerContainer.classList.add('paused'));
        }
    }

    // YouTube player setup
    function loadYouTubePlayer(url) {
        const videoId = getYouTubeId(url);
        if (!videoId) return;

        // Show loading
        loadingSpinner.style.display = 'block';

        // The YouTube IFrame API calls this when ready
        window.onYouTubeIframeAPIReady = function() {
            ytPlayer = new YT.Player('youtubePlayer', {
                videoId: videoId,
                playerVars: {
                    autoplay: 1,
                    controls: 0,
                    modestbranding: 1,
                    rel: 0,
                    showinfo: 0,
                    fs: 0,
                    iv_load_policy: 3,
                    disablekb: 1,
                    playsinline: 1
                },
                events: {
                    onReady: onYouTubeReady,
                    onStateChange: onYouTubeStateChange
                }
            });
        };
        // If API already loaded
        if (window.YT && YT.Player) {
            window.onYouTubeIframeAPIReady();
        }
    }

    function onYouTubeReady(event) {
        ytReady = true;
        loadingSpinner.style.display = 'none';
        ytPlayer.playVideo();
        // Update duration once
        updateYTProgress();
        setInterval(updateYTProgress, 250); // progress sync
        // Hide YouTube controls, we use custom
        playerContainer.classList.remove('paused');
    }

    function onYouTubeStateChange(event) {
        if (event.data === YT.PlayerState.PLAYING) {
            playerContainer.classList.remove('paused');
        } else if (event.data === YT.PlayerState.PAUSED) {
            playerContainer.classList.add('paused');
        } else if (event.data === YT.PlayerState.ENDED) {
            playerContainer.classList.add('paused');
        }
        // Check for ads when time updates
    }

    // Seek function for both players
    function seek(seconds) {
        if (isShowingAd) return;
        if (isYouTubeActive && ytPlayer && ytReady) {
            let newTime = ytPlayer.getCurrentTime() + seconds;
            let dur = ytPlayer.getDuration();
            newTime = Math.max(0, Math.min(newTime, dur));
            ytPlayer.seekTo(newTime, true);
        } else {
            let newTime = videoElement.currentTime + seconds;
            newTime = Math.max(0, Math.min(newTime, videoElement.duration));
            videoElement.currentTime = newTime;
        }
        seekText.textContent = Math.abs(seconds) + 's';
        seekIcon.innerHTML = seconds > 0 ? '<use href="#icon-forward"></use>' : '<use href="#icon-rewind"></use>';
        seekNotification.classList.add('show');
        setTimeout(() => seekNotification.classList.remove('show'), 500);
        showControlsTemporarily();
    }

    // Toggle play/pause
    function togglePlayPause() {
        if (isShowingAd) return;
        if (isYouTubeActive && ytPlayer && ytReady) {
            if (ytPlayer.getPlayerState() === YT.PlayerState.PLAYING) {
                ytPlayer.pauseVideo();
                playerContainer.classList.add('paused');
            } else {
                ytPlayer.playVideo();
                playerContainer.classList.remove('paused');
            }
        } else {
            if (videoElement.paused) {
                videoElement.play();
                playerContainer.classList.remove('paused');
            } else {
                videoElement.pause();
                playerContainer.classList.add('paused');
            }
        }
        showPlayPauseOverlay();
        showControlsTemporarily();
    }

    // Update time display and progress for YouTube
    function updateYTProgress() {
        if (!isYouTubeActive || !ytPlayer || !ytReady) return;
        let current = ytPlayer.getCurrentTime() || 0;
        let dur = ytPlayer.getDuration() || 0;
        currentTimeEl.textContent = formatTime(current);
        durationEl.textContent = formatTime(dur);
        if (dur) {
            progress.style.width = (current / dur) * 100 + '%';
        }
        // Check for ads (based on time)
        if (!isShowingAd && dur > 0) {
            const ad = shouldShowAd(current, dur);
            if (ad) showAd(ad);
        }
    }

    // Format time helper
    function formatTime(seconds) {
        if (isNaN(seconds) || seconds === 0) return '0:00';
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = Math.floor(seconds % 60);
        if (h > 0) return `${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        return `${m}:${s.toString().padStart(2,'0')}`;
    }

    // Ad logic (same as original, but adapted to work with both players)
    function shouldShowVideoAd(currentTime, duration) {
        if (!adsData.length || isShowingAd || !duration) return false;
        const percent = (currentTime / duration) * 100;
        for (const ad of adsData) {
            const adId = ad.url + (ad.time || '0%');
            if (ad.available && !shownAdIds.has(adId) && (ad.app === 'All' || ad.app === appName)) {
                const timePercent = parseFloat(ad.time || '0');
                if (timePercent <= percent) {
                    shownAdIds.add(adId);
                    return ad;
                }
            }
        }
        return false;
    }

    function showAd(ad) {
        if (!ad || !ad.url || isShowingAd) return;
        currentAd = ad;
        isShowingAd = true;
        adDuration = parseInt(ad.duration) || 20;
        adRemainingTime = adDuration;
        canSkipAd = false;

        // Pause main video (YouTube or native)
        if (isYouTubeActive && ytPlayer && ytReady) ytPlayer.pauseVideo();
        else videoElement.pause();

        adOverlay.classList.add('active');
        adLink.href = ad.link || '#';
        adLink.textContent = 'Visit Website';
        adInfo.textContent = 'Advertisement';
        loadAdVideo(ad.url);
        startAdTimer();
        adSkipButton.classList.remove('show');
        clearTimeout(adSkipTimeout);
        adSkipTimeout = setTimeout(() => {
            canSkipAd = true;
            adSkipButton.classList.add('show');
        }, adDuration * 1000);
    }

    function loadAdVideo(url) {
        if (adHls) adHls.destroy();
        adVideo.pause();
        adVideo.src = '';
        if (Hls.isSupported() && url.includes('.m3u8')) {
            adHls = new Hls();
            adHls.loadSource(url);
            adHls.attachMedia(adVideo);
            adHls.on(Hls.Events.MANIFEST_PARSED, () => adVideo.play());
        } else {
            adVideo.src = url;
            adVideo.play();
        }
    }

    function startAdTimer() {
        clearInterval(adTimerInterval);
        adTimerInterval = setInterval(() => {
            adRemainingTime--;
            if (canSkipAd) adTimer.textContent = 'Skip Ad';
            else adTimer.textContent = `Skip in ${adRemainingTime}s`;
            if (adVideo.ended) skipAd();
        }, 1000);
    }

    function skipAd() {
        isShowingAd = false;
        canSkipAd = false;
        adOverlay.classList.remove('active');
        adSkipButton.classList.remove('show');
        adVideo.pause();
        if (adHls) adHls.destroy();
        clearInterval(adTimerInterval);
        clearTimeout(adSkipTimeout);
        // Resume main video
        if (isYouTubeActive && ytPlayer && ytReady) ytPlayer.playVideo();
        else videoElement.play();
        showControlsTemporarily();
    }

    // Controls visibility
    function showControlsTemporarily() {
        if (isShowingAd) return;
        playerContainer.classList.add('show-controls');
        clearTimeout(controlsTimeout);
        if ((isYouTubeActive && ytPlayer && ytPlayer.getPlayerState() === YT.PlayerState.PLAYING) ||
            (!isYouTubeActive && !videoElement.paused)) {
            controlsTimeout = setTimeout(() => playerContainer.classList.remove('show-controls'), 2000);
        }
    }

    function showPlayPauseOverlay() {
        playPauseOverlay.classList.add('show');
        setTimeout(() => playPauseOverlay.classList.remove('show'), 300);
    }

    // Volume & mute
    function updateMuteButton() {
        const muted = isYouTubeActive ? false : videoElement.muted; // simplified for demo
        playerContainer.classList.toggle('muted', muted);
    }

    // Event listeners (native video)
    videoElement.addEventListener('timeupdate', function() {
        if (isYouTubeActive) return;
        currentTimeEl.textContent = formatTime(videoElement.currentTime);
        durationEl.textContent = formatTime(videoElement.duration);
        progress.style.width = (videoElement.currentTime / videoElement.duration) * 100 + '%';
        if (!isShowingAd && videoElement.duration) {
            const ad = shouldShowVideoAd(videoElement.currentTime, videoElement.duration);
            if (ad) showAd(ad);
        }
    });

    videoElement.addEventListener('waiting', () => loadingSpinner.style.display = 'block');
    videoElement.addEventListener('playing', () => loadingSpinner.style.display = 'none');

    // Double tap
    function setupDoubleTap(area, action) {
        area.addEventListener('dblclick', (e) => { e.preventDefault(); action(); });
        area.addEventListener('touchstart', (e) => {
            let now = Date.now();
            if (now - lastTap < 300) { e.preventDefault(); action(); }
            lastTap = now;
        });
    }
    let lastTap = 0;
    setupDoubleTap(doubleTapLeft, () => seek(-10));
    setupDoubleTap(doubleTapRight, () => seek(10));
    setupDoubleTap(doubleTapCenter, togglePlayPause);

    // Button listeners
    playPauseBtn.addEventListener('click', (e) => { e.stopPropagation(); togglePlayPause(); });
    rewindBtn.addEventListener('click', () => seek(-10));
    forwardBtn.addEventListener('click', () => seek(10));

    muteBtn.addEventListener('click', () => {
        if (isYouTubeActive && ytPlayer) {
            if (isMuted) ytPlayer.unMute(); else ytPlayer.mute();
            isMuted = !isMuted;
        } else {
            videoElement.muted = !videoElement.muted;
        }
        playerContainer.classList.toggle('muted');
    });

    volumeSlider.addEventListener('input', (e) => {
        let vol = parseFloat(e.target.value);
        if (isYouTubeActive && ytPlayer) ytPlayer.setVolume(vol * 100);
        else videoElement.volume = vol;
    });

    // Speed
    speedOptions.forEach(opt => {
        opt.addEventListener('click', function() {
            let sp = parseFloat(this.dataset.speed);
            if (isYouTubeActive && ytPlayer) ytPlayer.setPlaybackRate(sp);
            else videoElement.playbackRate = sp;
            speedBtn.textContent = sp + 'x';
            speedOptions.forEach(o => o.classList.remove('active'));
            this.classList.add('active');
            showControlsTemporarily();
        });
    });

    // Quality (only for HLS)
    qualityOptions.addEventListener('click', function(e) {
        let opt = e.target.closest('.quality-option');
        if (!opt || !hls) return;
        let q = opt.dataset.quality;
        if (q === 'auto') hls.currentLevel = -1;
        else hls.currentLevel = parseInt(q);
        qualityBtn.textContent = opt.textContent;
        document.querySelectorAll('.quality-option').forEach(o => o.classList.remove('active'));
        opt.classList.add('active');
        showControlsTemporarily();
    });

    // Fullscreen
    fullscreenBtn.addEventListener('click', () => {
        if (!document.fullscreenElement) playerContainer.requestFullscreen();
        else document.exitFullscreen();
    });
    document.addEventListener('fullscreenchange', () => {
        playerContainer.classList.toggle('fullscreen', !!document.fullscreenElement);
    });

    // Rotate (simplified)
    rotateBtn.addEventListener('click', () => {
        if (screen.orientation && screen.orientation.lock) {
            if (!document.fullscreenElement) playerContainer.requestFullscreen().then(() => {
                screen.orientation.lock('landscape').catch(()=>{});
            }); else screen.orientation.lock('landscape').catch(()=>{});
        } else {
            if (!document.fullscreenElement) playerContainer.requestFullscreen();
        }
    });

    // Share & Download (same as original)
    shareBtn.addEventListener('click', () => {
        if (navigator.share) navigator.share({ title: videoTitle, url: window.location.href });
        else navigator.clipboard.writeText(window.location.href).then(() => alert('Link copied!'));
    });

    downloadBtn.addEventListener('click', () => {
        if (adsData[0]?.downloader) {
            window.open(adsData[0].downloader.replace('simpleURL', encodeURIComponent(videoUrl)), '_blank');
        } else {
            let a = document.createElement('a');
            a.href = videoUrl;
            a.download = videoTitle + '.mp4';
            a.click();
        }
    });

    // Ad skip button
    adSkipButton.addEventListener('click', () => { if (canSkipAd) skipAd(); });

    // Initialize
    initPlayer();
})();
</script>
</body>
</html>